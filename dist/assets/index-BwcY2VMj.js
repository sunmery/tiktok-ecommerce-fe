import{V as G,U as $}from"./index-eJYtR5xA.js";var F={},q={exports:{}};function Q(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var R={exports:{}};const X={},Y=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"})),Z=G(Y);var H;function O(){return H||(H=1,function(o,e){(function(r,n){o.exports=n()})($,function(){var r=r||function(n,l){var f;if(typeof window<"u"&&window.crypto&&(f=window.crypto),typeof self<"u"&&self.crypto&&(f=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(f=globalThis.crypto),!f&&typeof window<"u"&&window.msCrypto&&(f=window.msCrypto),!f&&typeof $<"u"&&$.crypto&&(f=$.crypto),!f&&typeof Q=="function")try{f=Z}catch{}var v=function(){if(f){if(typeof f.getRandomValues=="function")try{return f.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof f.randomBytes=="function")try{return f.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},k=Object.create||function(){function t(){}return function(i){var c;return t.prototype=i,c=new t,t.prototype=null,c}}(),s={},w=s.lib={},p=w.Base=function(){return{extend:function(t){var i=k(this);return t&&i.mixIn(t),(!i.hasOwnProperty("init")||this.init===i.init)&&(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=w.WordArray=p.extend({init:function(t,i){t=this.words=t||[],i!=l?this.sigBytes=i:this.sigBytes=t.length*4},toString:function(t){return(t||u).stringify(this)},concat:function(t){var i=this.words,c=t.words,d=this.sigBytes,_=t.sigBytes;if(this.clamp(),d%4)for(var S=0;S<_;S++){var C=c[S>>>2]>>>24-S%4*8&255;i[d+S>>>2]|=C<<24-(d+S)%4*8}else for(var U=0;U<_;U+=4)i[d+U>>>2]=c[U>>>2];return this.sigBytes+=_,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=n.ceil(i/4)},clone:function(){var t=p.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],c=0;c<t;c+=4)i.push(v());return new h.init(i,t)}}),y=s.enc={},u=y.Hex={stringify:function(t){for(var i=t.words,c=t.sigBytes,d=[],_=0;_<c;_++){var S=i[_>>>2]>>>24-_%4*8&255;d.push((S>>>4).toString(16)),d.push((S&15).toString(16))}return d.join("")},parse:function(t){for(var i=t.length,c=[],d=0;d<i;d+=2)c[d>>>3]|=parseInt(t.substr(d,2),16)<<24-d%8*4;return new h.init(c,i/2)}},m=y.Latin1={stringify:function(t){for(var i=t.words,c=t.sigBytes,d=[],_=0;_<c;_++){var S=i[_>>>2]>>>24-_%4*8&255;d.push(String.fromCharCode(S))}return d.join("")},parse:function(t){for(var i=t.length,c=[],d=0;d<i;d++)c[d>>>2]|=(t.charCodeAt(d)&255)<<24-d%4*8;return new h.init(c,i)}},a=y.Utf8={stringify:function(t){try{return decodeURIComponent(escape(m.stringify(t)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(t){return m.parse(unescape(encodeURIComponent(t)))}},g=w.BufferedBlockAlgorithm=p.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(t){typeof t=="string"&&(t=a.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var i,c=this._data,d=c.words,_=c.sigBytes,S=this.blockSize,C=S*4,U=_/C;t?U=n.ceil(U):U=n.max((U|0)-this._minBufferSize,0);var x=U*S,B=n.min(x*4,_);if(x){for(var I=0;I<x;I+=S)this._doProcessBlock(d,I);i=d.splice(0,x),c.sigBytes-=B}return new h.init(i,B)},clone:function(){var t=p.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});w.Hasher=g.extend({cfg:p.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var i=this._doFinalize();return i},blockSize:16,_createHelper:function(t){return function(i,c){return new t.init(c).finalize(i)}},_createHmacHelper:function(t){return function(i,c){return new b.HMAC.init(t,c).finalize(i)}}});var b=s.algo={};return s}(Math);return r})}(R)),R.exports}(function(o,e){(function(r,n){o.exports=n(O())})($,function(r){return function(n){var l=r,f=l.lib,v=f.WordArray,k=f.Hasher,s=l.algo,w=[],p=[];(function(){function u(b){for(var t=n.sqrt(b),i=2;i<=t;i++)if(!(b%i))return!1;return!0}function m(b){return(b-(b|0))*4294967296|0}for(var a=2,g=0;g<64;)u(a)&&(g<8&&(w[g]=m(n.pow(a,1/2))),p[g]=m(n.pow(a,1/3)),g++),a++})();var h=[],y=s.SHA256=k.extend({_doReset:function(){this._hash=new v.init(w.slice(0))},_doProcessBlock:function(u,m){for(var a=this._hash.words,g=a[0],b=a[1],t=a[2],i=a[3],c=a[4],d=a[5],_=a[6],S=a[7],C=0;C<64;C++){if(C<16)h[C]=u[m+C]|0;else{var U=h[C-15],x=(U<<25|U>>>7)^(U<<14|U>>>18)^U>>>3,B=h[C-2],I=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;h[C]=x+h[C-7]+I+h[C-16]}var D=c&d^~c&_,V=g&b^g&t^b&t,M=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),N=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),E=S+N+D+p[C]+h[C],K=M+V;S=_,_=d,d=c,c=i+E|0,i=t,t=b,b=g,g=E+K|0}a[0]=a[0]+g|0,a[1]=a[1]+b|0,a[2]=a[2]+t|0,a[3]=a[3]+i|0,a[4]=a[4]+c|0,a[5]=a[5]+d|0,a[6]=a[6]+_|0,a[7]=a[7]+S|0},_doFinalize:function(){var u=this._data,m=u.words,a=this._nDataBytes*8,g=u.sigBytes*8;return m[g>>>5]|=128<<24-g%32,m[(g+64>>>9<<4)+14]=n.floor(a/4294967296),m[(g+64>>>9<<4)+15]=a,u.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var u=k.clone.call(this);return u._hash=this._hash.clone(),u}});l.SHA256=k._createHelper(y),l.HmacSHA256=k._createHmacHelper(y)}(Math),r.SHA256})})(q);var J=q.exports,W={exports:{}};(function(o,e){(function(r,n){o.exports=n(O())})($,function(r){return function(){var n=r,l=n.lib,f=l.WordArray,v=n.enc;v.Base64={stringify:function(s){var w=s.words,p=s.sigBytes,h=this._map;s.clamp();for(var y=[],u=0;u<p;u+=3)for(var m=w[u>>>2]>>>24-u%4*8&255,a=w[u+1>>>2]>>>24-(u+1)%4*8&255,g=w[u+2>>>2]>>>24-(u+2)%4*8&255,b=m<<16|a<<8|g,t=0;t<4&&u+t*.75<p;t++)y.push(h.charAt(b>>>6*(3-t)&63));var i=h.charAt(64);if(i)for(;y.length%4;)y.push(i);return y.join("")},parse:function(s){var w=s.length,p=this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var y=0;y<p.length;y++)h[p.charCodeAt(y)]=y}var u=p.charAt(64);if(u){var m=s.indexOf(u);m!==-1&&(w=m)}return k(s,w,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function k(s,w,p){for(var h=[],y=0,u=0;u<w;u++)if(u%4){var m=p[s.charCodeAt(u-1)]<<u%4*2,a=p[s.charCodeAt(u)]>>>6-u%4*2,g=m|a;h[y>>>2]|=g<<24-y%4*8,y++}return f.create(h,y)}}(),r.enc.Base64})})(W);var ee=W.exports,j={exports:{}};(function(o,e){(function(r,n){o.exports=n(O())})($,function(r){return function(){if(typeof ArrayBuffer=="function"){var n=r,l=n.lib,f=l.WordArray,v=f.init,k=f.init=function(s){if(s instanceof ArrayBuffer&&(s=new Uint8Array(s)),(s instanceof Int8Array||typeof Uint8ClampedArray<"u"&&s instanceof Uint8ClampedArray||s instanceof Int16Array||s instanceof Uint16Array||s instanceof Int32Array||s instanceof Uint32Array||s instanceof Float32Array||s instanceof Float64Array)&&(s=new Uint8Array(s.buffer,s.byteOffset,s.byteLength)),s instanceof Uint8Array){for(var w=s.byteLength,p=[],h=0;h<w;h++)p[h>>>2]|=s[h]<<24-h%4*8;v.call(this,p,w)}else v.apply(this,arguments)};k.prototype=f}}(),r.lib.WordArray})})(j);var te=j.exports,T=$&&$.__assign||function(){return T=Object.assign||function(o){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(o[l]=e[l])}return o},T.apply(this,arguments)},z=$&&$.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(F,"__esModule",{value:!0});var re=z(J),ne=z(ee),ie=z(te),oe=function(){function o(e){this.state="",this.codeVerifier="",this.corsRequestOptions={},this.config=e}return o.prototype.enableCorsCredentials=function(e){return this.corsRequestOptions=e?{credentials:"include",mode:"cors"}:{},this.corsRequestOptions},o.prototype.authorizeUrl=function(e){e===void 0&&(e={});var r=this.pkceChallengeFromVerifier(),n=new URLSearchParams(Object.assign({response_type:"code",client_id:this.config.client_id,state:this.getState(e.state||null),scope:this.config.requested_scopes,redirect_uri:this.config.redirect_uri,code_challenge:r,code_challenge_method:"S256"},e)).toString();return"".concat(this.config.authorization_endpoint,"?").concat(n)},o.prototype.exchangeForAccessToken=function(e,r){var n=this;return r===void 0&&(r={}),this.parseAuthResponseUrl(e).then(function(l){return fetch(n.config.token_endpoint,T({method:"POST",body:new URLSearchParams(Object.assign({grant_type:"authorization_code",code:l.code,client_id:n.config.client_id,redirect_uri:n.config.redirect_uri,code_verifier:n.getCodeVerifier()},r)),headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}},n.corsRequestOptions)).then(function(f){return f.json()})})},o.prototype.refreshAccessToken=function(e){return fetch(this.config.token_endpoint,{method:"POST",body:new URLSearchParams({grant_type:"refresh_token",client_id:this.config.client_id,refresh_token:e}),headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(r){return r.json()})},o.prototype.getCodeVerifier=function(){return this.codeVerifier===""&&(this.codeVerifier=this.randomStringFromStorage("pkce_code_verifier")),this.codeVerifier},o.prototype.getState=function(e){e===void 0&&(e=null);var r="pkce_state";return e!==null&&this.getStore().setItem(r,e),this.state===""&&(this.state=this.randomStringFromStorage(r)),this.state},o.prototype.parseAuthResponseUrl=function(e){var r=new URL(e).searchParams;return this.validateAuthResponse({error:r.get("error"),query:r.get("query"),state:r.get("state"),code:r.get("code")})},o.prototype.pkceChallengeFromVerifier=function(){var e=(0,re.default)(this.getCodeVerifier());return ne.default.stringify(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},o.prototype.randomStringFromStorage=function(e){var r=this.getStore().getItem(e);return r===null&&this.getStore().setItem(e,ie.default.random(64)),this.getStore().getItem(e)||""},o.prototype.validateAuthResponse=function(e){var r=this;return new Promise(function(n,l){return e.error?l({error:e.error}):e.state!==r.getState()?l({error:"Invalid State"}):n(e)})},o.prototype.getStore=function(){var e;return((e=this.config)===null||e===void 0?void 0:e.storage)||sessionStorage},o}(),se=F.default=oe;class A extends Error{}A.prototype.name="InvalidTokenError";function ae(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function ce(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return ae(e)}catch{return atob(e)}}function L(o,e){if(typeof o!="string")throw new A("Invalid token specified: must be a string");e||(e={});const r=e.header===!0?0:1,n=o.split(".")[r];if(typeof n!="string")throw new A(`Invalid token specified: missing part #${r+1}`);let l;try{l=ce(n)}catch(f){throw new A(`Invalid token specified: invalid base64 for part #${r+1} (${f.message})`)}try{return JSON.parse(l)}catch(f){throw new A(`Invalid token specified: invalid json for part #${r+1} (${f.message})`)}}class fe{constructor(e){this.config=e,(e.redirectPath===void 0||e.redirectPath===null)&&(this.config.redirectPath="/callback"),(e.scope===void 0||e.scope===null)&&(this.config.scope="profile"),this.pkce=new se({client_id:this.config.clientId,redirect_uri:`${window.location.origin}${this.config.redirectPath}`,authorization_endpoint:`${this.config.serverUrl.trim()}/login/oauth/authorize`,token_endpoint:`${this.config.serverUrl.trim()}/api/login/oauth/access_token`,requested_scopes:this.config.scope||"profile",storage:this.config.storage})}getOrSaveState(){const e=sessionStorage.getItem("casdoor-state");if(e!==null)return e;{const r=Math.random().toString(36).slice(2);return sessionStorage.setItem("casdoor-state",r),r}}clearState(){sessionStorage.removeItem("casdoor-state")}getSignupUrl(e=!0){return e?(sessionStorage.setItem("signinUrl",this.getSigninUrl()),`${this.config.serverUrl.trim()}/signup/${this.config.appName}`):this.getSigninUrl().replace("/login/oauth/authorize","/signup/oauth/authorize")}getSigninUrl(){const e=this.config.redirectPath&&this.config.redirectPath.includes("://")?this.config.redirectPath:`${window.location.origin}${this.config.redirectPath}`,r=this.getOrSaveState();return`${this.config.serverUrl.trim()}/login/oauth/authorize?client_id=${this.config.clientId}&response_type=code&redirect_uri=${encodeURIComponent(e)}&scope=${this.config.scope}&state=${r}`}getUserProfileUrl(e,r){let n="";return r!=null&&(n=`?access_token=${r.accessToken}`),`${this.config.serverUrl.trim()}/users/${this.config.organizationName}/${e}${n}`}getMyProfileUrl(e,r=""){let n="";return e!=null?(n=`?access_token=${e.accessToken}`,r!==""&&(n+=`&returnUrl=${r}`)):r!==""&&(n=`?returnUrl=${r}`),`${this.config.serverUrl.trim()}/account${n}`}async signin(e,r,n,l){if(!n||!l){const v=new URLSearchParams(window.location.search);n=v.get("code"),l=v.get("state")}const f=this.getOrSaveState();return this.clearState(),l!==f?new Promise((v,k)=>{setTimeout(()=>{v({status:"error",msg:`invalid state parameter, expected: ${f}, got: ${l}`})},10)}):fetch(`${e}${r||this.config.signinPath||"/api/signin"}?code=${n}&state=${l}`,{method:"POST",credentials:"include"}).then(v=>v.json())}isSilentSigninRequested(){return new URLSearchParams(window.location.search).get("silentSignin")==="1"}silentSignin(e,r){const n=document.createElement("iframe");n.style.display="none",n.src=`${this.getSigninUrl()}&silentSignin=1`;const l=f=>{if(window!==window.parent)return null;const v=f.data;v.tag!=="Casdoor"||v.type!=="SilentSignin"||(v.data==="success"?e(v):r(v))};window.addEventListener("message",l),document.body.appendChild(n)}async popupSignin(e,r,n){const v=window.screen.width/2-250,k=window.screen.height/2-600/2,s=window.open(this.getSigninUrl()+"&popup=1","login",`width=500,height=600,top=${k},left=${v}`),w=p=>{p.origin===this.config.serverUrl&&(p.data.type==="windowClosed"&&n&&n("login failed"),p.data.type==="loginSuccess"&&(this.signin(e,r,p.data.data.code,p.data.data.state).then(h=>{sessionStorage.setItem("token",h.token),window.location.reload()}),s.close()))};window.addEventListener("message",w)}async signin_redirect(e){window.location.assign(this.pkce.authorizeUrl(e))}async exchangeForAccessToken(e){return this.pkce.exchangeForAccessToken(window.location.href,e)}async getUserInfo(e){return fetch(`${this.config.serverUrl.trim()}/api/userinfo`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}).then(r=>r.json())}parseAccessToken(e){try{const r=L(e,{header:!0}),n=L(e);return{header:r,payload:n}}catch(r){throw new Error(r.message)}}refreshAccessToken(e){return this.pkce.refreshAccessToken(e)}}const P={serverUrl:"http://localhost:8000",signinPath:"/v1/user",clientId:"58ae47eed5903ca1c3ce",organizationName:"tiktok",appName:"e-commence",redirectPath:"/callback"},ue="http://localhost:30001",he=new fe(P),de=()=>{const o=localStorage.getItem("token");return o!==null&&o.length>0},ge=o=>{localStorage.setItem("token",o)},pe=o=>{window.location.href=o},ve=()=>he.getSigninUrl(),we=async()=>await(await fetch(`${ue}/v1/user/profile`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),ye=async()=>await(await fetch(`${P.serverUrl}/api/get-users?owner=${P.organizationName}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),_e=o=>{console.log(o)};export{he as C,ye as a,pe as b,ve as c,ue as d,ge as e,we as g,de as i,_e as s};
